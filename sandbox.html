<html>
<head>
  <title>TimeTimer</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/progressbar.js/1.0.1/progressbar.js"></script>
  <style type="text/css">
  #container {
    margin: auto;
    margin-top: 256px;
    width: 512px;
    height: 512px;
    position: relative;
  }
  #knob {
    position: absolute;
    height: 20px;
    width: 20px;
    background: #A64B00;
    border-radius: 10px;
    cursor: pointer;
    z-index: 3;
  }
  </style>
  <script>
    var $container = $('#container');
    var $slider = $('#knob');
    
    window.onload = function(){
      var container = document.getElementById("container");
      var knob = document.getElementById("knob");
      var bar = new ProgressBar.Circle('#container', {
        trailWidth: 30,
        trailColor: '#ddd',
        color: '#aaa',
        // This has to be the same size as the maximum width to
        // prevent clipping
        strokeWidth: 25,
        duration: 3000,
        from: { color: '#8B0000', width: 25 },
        to: { color: '#B22222', width: 25 },
        // Set default step function for all animate calls
        step: function(state, circle) {
          circle.path.setAttribute('stroke', state.color);
          circle.path.setAttribute('stroke-width', state.width);

          var value = Math.round(circle.value() * 100);
          circle.setText(value);
          
         // X = Math.round(radius *  Math.sin(360 * circle.value() * Math.PI / 180));
         // Y = Math.round(radius * -Math.cos(360 * circle.value() * Math.PI / 180));
         //
         // $slider.css({
         //   left: X + radius - sliderWidth / 2,
         //   top:  Y + radius - sliderHeight / 2
         // });
        }
      });
      bar.svg.style.transform= 'scale(-1, 1)';
      bar.text.style.fontFamily = 'Helvetica';
      bar.text.style.fontSize = '2rem';
      bar.set(0.0);

      var sliderWidth = $slider.width();
      var sliderHeight = $slider.height();
      var radius = $container.width() / 2;
      var deg = 0;

      X = Math.round(radius *  Math.sin(deg * Math.PI / 180));
      Y = Math.round(radius * -Math.cos(deg * Math.PI / 180));
      $slider.css({
        left: X + radius - sliderWidth  / 2,
        top:  Y + radius - sliderHeight / 2
      });

      var mdown = false;
      $container
        .mousedown(function(e) {
          mdown = true;
          bar.stop(); 
          e.originalEvent.preventDefault();
        })
        .mouseup(function(e) {
          mdown = false;
          bar.animate(0.0);
        })
        .mousemove(function(e) {
          if (mdown) {
  
            var mPos = {
              x: e.target.offsetLeft + e.offsetX,
              y: e.target.offsetTop + e.offsetY
            };

            var atan = Math.atan2(mPos.x - radius, mPos.y - radius);
            deg = -atan / (Math.PI / 180) + 180; 
            X = Math.round(radius *  Math.sin(deg * Math.PI / 180));
            Y = Math.round(radius * -Math.cos(deg * Math.PI / 180));

            $slider.css({
              left: X + radius - sliderWidth / 2,
              top:  Y + radius - sliderHeight / 2
            });
            bar.set(1 - (deg / 360.0));
          }
        });

        
     }
  </script>
</head>

<body>
  <div id="container">
    <div id="knob"></div>
  </div>
</body>
</html>
