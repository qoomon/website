<!DOCTYPE html>
<html>
<head>
    <title>IP Info</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <link
        type="text/css" rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans:400,500,700|Google+Sans+Text:400&amp;lang=en">
    <style>
        #map {
            position: absolute;
            top: 0;
            right: 0;
            height: 100vh;
            width: 100vw;
        }
        #info {
            position: absolute;
            bottom: 0;
            left: 0;
            margin: 10px;
            padding: 9px 11px;
            width: 279.5px;
            background-color: white;
            border-radius: 2px;
            box-shadow: rgb(0 0 0 / 30%) 0px 1px 4px -1px;
            user-select: text;
            font-family: Roboto, Arial;
        }
        #ip {
            color: black;
            font-size: 14px;
            height: 16px;
            font-weight: 500;
        }
        #org {
            color: #5b5b5b;
            font-size: 12px;
            margin-top: 6px;
        }
        #details {
            text-decoration: none;
            color: #1a73e8;
            font-size: 12px;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div id="map"></div>

    <div id="info">
        <div id="ip">Loading...</div>
        <div id="org"></div>
        <div>
            <a id="details" href="#" target="_blank" aria-label="View details">View details</a>
        </div>
    </div>

    <script>
        window.initMap = () => {
          const map = new google.maps.Map(document.getElementById("map"), {
            mapId: "ipinfo",
            zoom: 3,
            center: { lat: 0, lng: 0 },
            gestureHandling: "greedy",
          });

          const marker = new google.maps.marker.AdvancedMarkerElement({
            map,
            title: 'Your location',
          });

          updateInfo(map, marker);
          window.addEventListener('online', () => updateInfo(map, marker));
        };

        async function updateInfo(map, marker) {
            const ipInfo = await fetch('https://api.ipbase.com/v2/info')
                .then(res => res.json())
                .then(body => ({
                  ip: body.ip,
                  organization: body.organization,
                  position: {
                    lat: body.latitude,
                    lng: body.longitude,
                  },
                  detailsUrl: 'https://api.ipbase.com/v2/info',
                })).catch(() => fetch('https://ipapi.co/json')
                .then(res => res.json())
                .then(body => ({
                  ip: body.ip,
                  organization: body.org,
                  position: {
                    lat: body.latitude,
                    lng: body.longitude,
                    },
                  detailsUrl: 'https://ipapi.co/json',
                }))).catch(() => fetch('https://ipinfo.io/json')
                .then(res => res.json())
                .then(body => ({
                  ip: body.ip,
                  organization: body.org,
                  position: {
                    lat: body.split(',')[0],
                    lng: body.split(',')[1],
                    },
                  detailsUrl: 'https://ipinfo.io/json',
                })));

            console.info('ipInfo:', ipInfo);

            marker.position = ipInfo.position;
            map.setZoom(10);
            map.setCenter(marker.position);

            const infoElement = document.getElementById('info');

            const ipElement = document.getElementById('ip');
            ipElement.innerText = ipInfo.ip;

            const orgElement = document.getElementById('org');
            orgElement.innerText = ipInfo.organization;

            const detailsElement = document.getElementById('details');
            detailsElement.href = ipInfo.detailsUrl;
        };
    </script>

    <script
          src="https://maps.googleapis.com/maps/api/js?v=weekly&libraries=marker&loading=async&callback=initMap&key=AIzaSyAOVYRIgupAurZup5y1PRh8Ismb1A3lLao"
          defer
    ></script>
</body>
</html>
